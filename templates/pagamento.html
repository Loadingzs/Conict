<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pagamento - Farm√°cia Online</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .payment-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }
        .payment-form {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #dee2e6;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        .btn-payment {
            background: #28a745;
            color: white;
            padding: 12px;
            font-size: 18px;
            font-weight: bold;
        }
        .btn-payment:hover {
            background: #218838;
            color: white;
        }
        .security-badge {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('home') }}">üè• Farm√°cia Online</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="{{ url_for('meus_pedidos') }}">Meus Pedidos</a>
                <a class="nav-link" href="{{ url_for('logout') }}">Sair</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-8 mx-auto">
                <h2 class="text-center mb-4">üí≥ Pagamento do Pedido #{{ pedido.id }}</h2>
                
                <!-- Resumo do Pedido -->
                <div class="card mb-4">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">Resumo do Pedido</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6">
                                <strong>Total:</strong>
                            </div>
                            <div class="col-6 text-end">
                                <strong class="text-success">R$ {{ "%.2f"|format(pedido.total) }}</strong>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-6">
                                <strong>Status:</strong>
                            </div>
                            <div class="col-6 text-end">
                                <span class="badge bg-warning text-dark">{{ pedido.status }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Formas de Pagamento -->
                <div class="card mb-4">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">Escolha a Forma de Pagamento</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="radio" name="paymentMethod" id="creditCard" value="creditcard" checked>
                            <label class="form-check-label" for="creditCard">
                                üí≥ Cart√£o de Cr√©dito
                            </label>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="radio" name="paymentMethod" id="pix" value="pix">
                            <label class="form-check-label" for="pix">
                                üì± PIX
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="paymentMethod" id="boleto" value="boleto">
                            <label class="form-check-label" for="boleto">
                                üìÑ Boleto Banc√°rio
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Formul√°rio do Cart√£o de Cr√©dito -->
                <div id="creditCardForm">
                    <div class="payment-card">
                        <div class="text-center mb-3">
                            <h5>Cart√£o de Cr√©dito</h5>
                        </div>
                        <form id="paymentForm" action="{{ url_for('confirmar_pagamento', pedido_id=pedido.id) }}" method="POST">
                            <div class="form-group">
                                <label for="cardNumber">N√∫mero do Cart√£o</label>
                                <input type="text" class="form-control" id="cardNumber" name="cardNumber" 
                                       placeholder="0000 0000 0000 0000" maxlength="19" required>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="expiryDate">Validade</label>
                                        <input type="text" class="form-control" id="expiryDate" name="expiryDate" 
                                               placeholder="MM/AA" maxlength="5" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="cvv">CVV</label>
                                        <input type="text" class="form-control" id="cvv" name="cvv" 
                                               placeholder="000" maxlength="3" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="cardName">Nome no Cart√£o</label>
                                <input type="text" class="form-control" id="cardName" name="cardName" 
                                       placeholder="Como est√° no cart√£o" required>
                            </div>
                            
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="saveCard" name="saveCard">
                                <label class="form-check-label" for="saveCard">
                                    Salvar dados do cart√£o para pr√≥ximas compras
                                </label>
                            </div>

                            <div class="security-badge">
                                üîí Pagamento 100% seguro - Ambiente de demonstra√ß√£o
                            </div>

                            <button type="submit" class="btn btn-payment w-100 mt-3">
                                ‚úÖ Confirmar Pagamento - R$ {{ "%.2f"|format(pedido.total) }}
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Mensagens para outros m√©todos -->
                <div id="pixMessage" class="alert alert-info" style="display: none;">
                    <h5>Pagamento via PIX</h5>
                    <p>Ap√≥s confirmar, voc√™ receber√° um QR Code para realizar o pagamento.</p>
                    <button class="btn btn-success">Gerar QR Code PIX</button>
                </div>

                <div id="boletoMessage" class="alert alert-warning" style="display: none;">
                    <h5>Pagamento via Boleto</h5>
                    <p>O boleto ser√° gerado e poder√° ser impresso ou pago via internet banking.</p>
                    <button class="btn btn-primary">Emitir Boleto</button>
                </div>

                <div class="text-center mt-3">
                    <a href="{{ url_for('meus_pedidos') }}" class="btn btn-outline-secondary">‚Üê Voltar para Meus Pedidos</a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Formata√ß√£o do n√∫mero do cart√£o
        document.getElementById('cardNumber').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{4})(?=\d)/g, '$1 ');
            e.target.value = value.substring(0, 19);
        });

        // Formata√ß√£o da data de validade
        document.getElementById('expiryDate').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.substring(0, 2) + '/' + value.substring(2, 4);
            }
            e.target.value = value.substring(0, 5);
        });

        // Alternar entre m√©todos de pagamento
        document.querySelectorAll('input[name="paymentMethod"]').forEach(radio => {
            radio.addEventListener('change', function() {
                document.getElementById('creditCardForm').style.display = 
                    this.value === 'creditcard' ? 'block' : 'none';
                document.getElementById('pixMessage').style.display = 
                    this.value === 'pix' ? 'block' : 'none';
                document.getElementById('boletoMessage').style.display = 
                    this.value === 'boleto' ? 'block' : 'none';
            });
        });

        // Simula√ß√£o de processamento
        document.getElementById('paymentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const cardNumber = document.getElementById('cardNumber').value;
            const expiryDate = document.getElementById('expiryDate').value;
            const cvv = document.getElementById('cvv').value;
            const cardName = document.getElementById('cardName').value;

            // Valida√ß√µes b√°sicas
            if (!cardNumber || !expiryDate || !cvv || !cardName) {
                alert('Por favor, preencha todos os campos do cart√£o.');
                return;
            }

            if (cardNumber.replace(/\s/g, '').length !== 16) {
                alert('N√∫mero do cart√£o deve ter 16 d√≠gitos.');
                return;
            }

            // Simular processamento
            const button = this.querySelector('button[type="submit"]');
            button.innerHTML = '‚è≥ Processando pagamento...';
            button.disabled = true;

            // Simular delay de processamento
            setTimeout(() => {
                // Enviar formul√°rio para o backend
                this.submit();
            }, 2000);
        });
    </script>
</body>
</html>